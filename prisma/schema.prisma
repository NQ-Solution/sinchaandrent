generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// 브랜드
model Brand {
  id           String         @id @default(cuid())
  name         String         // 대표 이름
  nameKr       String         // 한글명
  nameEn       String?        // 영문명
  logo         String?        // 로고 (base64 또는 URL)
  isDomestic   Boolean        @default(true) // true: 국산, false: 수입
  sortOrder    Int            @default(0)
  isActive     Boolean        @default(true)
  vehicles     Vehicle[]
  masterColors MasterColor[]  // 브랜드별 마스터 색상
  masterOptions MasterOption[] // 브랜드별 마스터 옵션
  createdAt    DateTime       @default(now())
  updatedAt    DateTime       @updatedAt
}

// 브랜드별 마스터 색상 (중복 방지)
model MasterColor {
  id        String         @id @default(cuid())
  brandId   String
  brand     Brand          @relation(fields: [brandId], references: [id], onDelete: Cascade)
  type      ColorType
  name      String
  hexCode   String         // #FFFFFF
  sortOrder Int            @default(0)
  isActive  Boolean        @default(true)
  vehicles  VehicleColor[] // 이 색상을 사용하는 차량들
  createdAt DateTime       @default(now())
  updatedAt DateTime       @updatedAt

  @@unique([brandId, type, name]) // 브랜드 내 타입별 색상명 중복 방지
  @@index([brandId])
}

// 브랜드별 마스터 옵션 (중복 방지)
model MasterOption {
  id          String          @id @default(cuid())
  brandId     String
  brand       Brand           @relation(fields: [brandId], references: [id], onDelete: Cascade)
  name        String
  description String?
  category    String?         // 안전, 편의, 외관 등
  sortOrder   Int             @default(0)
  isActive    Boolean         @default(true)
  vehicles    VehicleOption[] // 이 옵션을 사용하는 차량들
  createdAt   DateTime        @default(now())
  updatedAt   DateTime        @updatedAt

  @@unique([brandId, name]) // 브랜드 내 옵션명 중복 방지
  @@index([brandId])
}

// 차량
model Vehicle {
  id          String          @id @default(cuid())
  brandId     String
  brand       Brand           @relation(fields: [brandId], references: [id])
  name        String
  category    VehicleCategory
  fuelTypes   String[]        // 연료 타입 배열 (복수 선택 가능: 가솔린, 디젤 등)
  driveTypes  String[]        // 구동방식 배열 (전륜, 후륜, 4륜 등 복수 가능)
  seatingCapacityMin Int?     // 최소 승차 인원 (예: 5)
  seatingCapacityMax Int?     // 최대 승차 인원 (예: 7)

  // 가격 (관리자 직접 입력)
  basePrice   Int // 기본 차량가 (참고용)

  // 보증금 0% 렌트 가격
  rentPrice60_0   Int?  // 60개월 보증금 0%
  rentPrice48_0   Int?  // 48개월 보증금 0%
  rentPrice36_0   Int?  // 36개월 보증금 0%
  rentPrice24_0   Int?  // 24개월 보증금 0%

  // 보증금 25% 렌트 가격
  rentPrice60_25  Int?  // 60개월 보증금 25%
  rentPrice48_25  Int?  // 48개월 보증금 25%
  rentPrice36_25  Int?  // 36개월 보증금 25%
  rentPrice24_25  Int?  // 24개월 보증금 25%

  // 보증금 50% 렌트 가격
  rentPrice60_50  Int?  // 60개월 보증금 50%
  rentPrice48_50  Int?  // 48개월 보증금 50%
  rentPrice36_50  Int?  // 36개월 보증금 50%
  rentPrice24_50  Int?  // 24개월 보증금 50%

  // 이미지 (base64 또는 URL)
  thumbnail       String?  // 대표 이미지
  images          String[] // 갤러리 이미지
  imageSizePreset String?  // 이미지 크기 프리셋 (vehicle, vehicleHD, banner, original)
  imagePadding    Int?     // 이미지 여백 퍼센트 (0, 5, 10, 15, 20)

  // 모델 정보
  baseModelName String?  // 기본 모델명 (예: "가솔린 1.6")
  hasOtherModels Boolean @default(true)  // 다른 모델 있음 여부

  // 상태
  isPopular Boolean @default(false)
  isNew     Boolean @default(false)
  isActive  Boolean @default(true)
  sortOrder Int     @default(0)

  // 관계
  trims          Trim[]
  colors         Color[]          // 기존 (마이그레이션 후 제거)
  options        Option[]         // 기존 (마이그레이션 후 제거)
  vehicleColors  VehicleColor[]   // 새: 마스터 색상 연결
  vehicleOptions VehicleOption[]  // 새: 마스터 옵션 연결

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([brandId])
  @@index([isActive, isPopular])
}

enum VehicleCategory {
  SEDAN
  SUV
  TRUCK
  VAN
  EV
  COMPACT
  HATCHBACK
  COUPE
  CONVERTIBLE
}

// FuelType은 더 이상 enum이 아닌 String 배열로 저장됨
// 가능한 값: GASOLINE, DIESEL, HYBRID, EV, LPG

// 트림
model Trim {
  id          String       @id @default(cuid())
  vehicleId   String
  vehicle     Vehicle      @relation(fields: [vehicleId], references: [id], onDelete: Cascade)
  name        String
  description String?
  price       Int          @default(0) // 추가 가격
  sortOrder   Int          @default(0)
  colors      TrimColor[]  // 트림별 색상 연결
  options     TrimOption[] // 트림별 옵션 연결

  @@index([vehicleId])
}

// 색상 (기존 - 마이그레이션 후 제거 예정)
model Color {
  id        String    @id @default(cuid())
  vehicleId String
  vehicle   Vehicle   @relation(fields: [vehicleId], references: [id], onDelete: Cascade)
  type      ColorType
  name      String
  hexCode   String // #FFFFFF
  price     Int       @default(0) // 추가 가격
  sortOrder Int       @default(0)

  @@index([vehicleId])
}

enum ColorType {
  EXTERIOR
  INTERIOR
}

// 트림별 색상 연결 (다대다 관계)
model TrimColor {
  id             String        @id @default(cuid())
  trimId         String
  trim           Trim          @relation(fields: [trimId], references: [id], onDelete: Cascade)
  vehicleColorId String
  vehicleColor   VehicleColor  @relation(fields: [vehicleColorId], references: [id], onDelete: Cascade)

  @@unique([trimId, vehicleColorId])
  @@index([trimId])
  @@index([vehicleColorId])
}

// 옵션 (기존 - 마이그레이션 후 제거 예정)
model Option {
  id          String  @id @default(cuid())
  vehicleId   String
  vehicle     Vehicle @relation(fields: [vehicleId], references: [id], onDelete: Cascade)
  name        String
  description String?
  price       Int     @default(0) // 추가 가격
  category    String? // 안전, 편의, 외관 등
  sortOrder   Int     @default(0)

  @@index([vehicleId])
}

// 트림별 옵션 연결 (다대다 관계)
model TrimOption {
  id              String         @id @default(cuid())
  trimId          String
  trim            Trim           @relation(fields: [trimId], references: [id], onDelete: Cascade)
  vehicleOptionId String
  vehicleOption   VehicleOption  @relation(fields: [vehicleOptionId], references: [id], onDelete: Cascade)
  isIncluded      Boolean        @default(false) // true: 기본 포함, false: 추가 옵션

  @@unique([trimId, vehicleOptionId])
  @@index([trimId])
  @@index([vehicleOptionId])
}

// 차량-마스터색상 연결 (차량별 가격 정보 포함)
model VehicleColor {
  id            String       @id @default(cuid())
  vehicleId     String
  vehicle       Vehicle      @relation(fields: [vehicleId], references: [id], onDelete: Cascade)
  masterColorId String
  masterColor   MasterColor  @relation(fields: [masterColorId], references: [id], onDelete: Cascade)
  price         Int          @default(0) // 이 차량에서의 추가 가격 (차량마다 다를 수 있음)
  sortOrder     Int          @default(0)
  isAvailable   Boolean      @default(true) // 현재 이 차량에서 선택 가능 여부
  trims         TrimColor[]  // 이 색상이 적용되는 트림들

  @@unique([vehicleId, masterColorId])
  @@index([vehicleId])
  @@index([masterColorId])
}

// 차량-마스터옵션 연결 (차량별 가격 정보 포함)
model VehicleOption {
  id             String        @id @default(cuid())
  vehicleId      String
  vehicle        Vehicle       @relation(fields: [vehicleId], references: [id], onDelete: Cascade)
  masterOptionId String
  masterOption   MasterOption  @relation(fields: [masterOptionId], references: [id], onDelete: Cascade)
  price          Int           @default(0) // 이 차량에서의 추가 가격 (차량마다 다를 수 있음)
  sortOrder      Int           @default(0)
  isAvailable    Boolean       @default(true) // 현재 이 차량에서 선택 가능 여부
  trims          TrimOption[]  // 이 옵션이 적용되는 트림들

  @@unique([vehicleId, masterOptionId])
  @@index([vehicleId])
  @@index([masterOptionId])
}

// FAQ
model FAQ {
  id        String   @id @default(cuid())
  question  String
  answer    String
  sortOrder Int      @default(0)
  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

// 설정
model Setting {
  id          String  @id @default(cuid())
  key         String  @unique
  value       String
  description String?
}

// 관리자
model Admin {
  id        String   @id @default(cuid())
  email     String   @unique
  password  String // hashed
  name      String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

// 이벤트 배너
model Banner {
  id              String    @id @default(cuid())
  title           String    // 배너 제목
  subtitle        String?   // 배너 부제목
  image           String?   // 배너 이미지 (base64 또는 URL)
  mobileImage     String?   // 모바일용 이미지 (없으면 image 사용)
  link            String?   // 클릭 시 이동할 링크
  linkText        String?   // 링크 버튼 텍스트
  description     String?   // 배너 설명 텍스트
  backgroundColor String?   // 배경색 (텍스트 배너용)
  textColor       String?   // 텍스트 색상 (텍스트 배너용)
  startDate       DateTime? // 노출 시작일
  endDate         DateTime? // 노출 종료일
  sortOrder       Int       @default(0)
  isActive        Boolean   @default(true)
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt
}

// 제휴사 (파트너)
model Partner {
  id        String   @id @default(cuid())
  name      String   // 제휴사명 (예: 산은캐피탈)
  logo      String?  // 로고 이미지
  link      String?  // 제휴사 링크
  category  String?  // 카테고리 (캐피탈, 카드 등)
  sortOrder Int      @default(0)
  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

// 사업자 정보 (대출모집법인 정보)
model CompanyInfo {
  id          String   @id @default(cuid())
  key         String   @unique // 설정 키
  value       String   // 값
  description String?  // 설명
  updatedAt   DateTime @updatedAt
}
